<!doctype html>
<html lang="zh-Hant">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title id="pageTitle">機構模擬工具</title>
    <link rel="stylesheet" href="css/styles.css" />
    <style>
        #svgWrap,
        #partsWrap {
            background: #fff;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
    </style>
</head>

<body>
    <div class="nav-header">
        <div class="nav-content">
            <div>
                <a href="index.html" class="nav-back">
                    <span style="font-size: 20px;">←</span>
                    <span>返回機構選單</span>
                </a>
            </div>
            <h2 class="nav-title">
                <span id="mechIcon">🔗</span>
                <span id="mechName">機構設計</span>
            </h2>
            <div id="mechSelectorContainer"></div>
        </div>
    </div>

    <div class="row">
        <div class="card">
            <div id="parametersPanel"></div>

            <div style="height:10px"></div>
            <h3>動畫控制</h3>
            <div class="grid">
                <div>
                    <label>動畫速度（RPM）</label>
                    <input id="animSpeed" type="number" min="1" max="120" step="1" value="10" />
                </div>
                <div class="flex-end">
                    <button id="btnPlayAnim" class="btn-play" style="flex:1;">▶ 播放</button>
                    <button id="btnPauseAnim" class="btn-pause" style="flex:1;" disabled>⏸ 暫停</button>
                    <button id="btnStopAnim" class="btn-stop" style="flex:1;" disabled>⏹ 停止</button>
                </div>
            </div>

            <div style="height:10px"></div>
            <h3>零件規格</h3>
            <div id="partSpecsPanel"></div>

            <div style="height:10px"></div>
            <h3>加工設定（GRBL / 3018）</h3>
            <div class="grid">
                <div>
                    <label>工作範圍 X（mm）</label>
                    <input id="workX" type="number" value="300" />
                </div>
                <div>
                    <label>工作範圍 Y（mm）</label>
                    <input id="workY" type="number" value="180" />
                </div>
                <div>
                    <label>刀徑（mm）</label>
                    <input id="toolD" type="number" min="0.5" max="10" step="0.1" value="3.0" />
                </div>
                <div>
                    <label>孔加工方式</label>
                    <select id="holeMode">
                        <option value="drill">鑽中心點</option>
                        <option value="mill">銑內徑</option>
                    </select>
                </div>
                <div>
                    <label>材料厚度 T（mm）</label>
                    <input id="thickness" type="number" min="1" max="30" step="0.1" value="3.0" />
                </div>
                <div>
                    <label>穿透餘量（mm）</label>
                    <input id="overcut" type="number" min="0" max="2" step="0.1" value="0.5" />
                </div>
                <div>
                    <label>每層下刀（mm）</label>
                    <input id="stepdown" type="number" min="0.1" max="5" step="0.1" value="0.5" />
                </div>
                <div>
                    <label>SAFE_Z（mm）</label>
                    <input id="safeZ" type="number" min="1" max="30" step="0.5" value="5" />
                </div>
                <div>
                    <label>Feed XY（mm/min）</label>
                    <input id="feedXY" type="number" min="50" max="3000" step="10" value="400" />
                </div>
                <div>
                    <label>Feed Z（mm/min）</label>
                    <input id="feedZ" type="number" min="30" max="2000" step="10" value="100" />
                </div>
                <div>
                    <label>主軸 S（可空白）</label>
                    <input id="spindle" type="number" min="1000" max="30000" step="100" placeholder="例如 12000" />
                </div>
            </div>

            <div class="btnrow">
                <button id="btnGen">生成 G-code</button>
            </div>

            <div style="height:10px"></div>
            <div class="note">
                <div class="warn">注意：v0.1 不含 tabs。外形切完零件可能鬆脫，請用雙面膠/壓板固定。</div>
                <div>預設：G21 / G90 / SAFE_Z 先抬刀、先鑽孔後外形、多層 stepdown。</div>
            </div>

            <div style="height:10px"></div>
            <h3>輸出 / 訊息</h3>
            <div id="log" class="card" style="padding:10px; background:#fafafa;"></div>
            <div class="btnrow" id="dlButtons"></div>
        </div>

        <div>
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                    <h3 style="margin:0;">2D 模擬</h3>
                    <button class="primary" id="btnUpdate">更新模擬 / 預覽</button>
                </div>
                <div id="svgWrap"></div>
                <div class="note" style="margin-top:8px;" id="simNotes"></div>
            </div>

            <div class="card" style="margin-top:16px;">
                <h3>零件排版預覽</h3>
                <div id="partsWrap"></div>
                <div class="note" style="margin-top:8px;">
                    零件排版在工作區（0..X, 0..Y），每根各自輸出一份 G-code。
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script type="module">
        import(`./js/mechanism-loader.js?t=${Date.now()}`);
    </script>
</body>

</html>